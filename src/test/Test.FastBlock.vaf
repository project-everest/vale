
include "../arch/x64/X64.Vale.InsBasic.vaf"
include "../arch/x64/X64.Vale.InsMem.vaf"

module Test.FastBlock

#verbatim
(* To compile this file do:
   -- vale.exe -fstarText -in Test.FastBlock.vaf -out Test.FastBlock.fst -outi Test.FastBlock.fsti
   -- fstar Test.FastBlock.fst --include ../arch/x64/ --log_queries --hint_info --z3refresh --debug Test.FastBlock --debug_level print_normalized_terms |& tee weakest_pre_dump
   
*)
#endverbatim

#verbatim{:interface}{:implementation}
open X64.Machine_s
open X64.Vale.State_i
open X64.Vale.Decls_i
open X64.Vale.InsBasic
open X64.Vale.InsMem
open X64.Vale.StrongPost_i
#endverbatim

#reset-options "--z3rlimit 20"

procedure Copy64()
    requires/ensures
        Map.contains(mem, rsi);
    reads
        rsi; mem;
    modifies
        rax;
{
    assert{:fast_block} true;
    Load64(rax, rsi, 0);
    assert (rax == mem[rsi + 0]);
}
